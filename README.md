
# ASP.NET API Проект (SQLite + EF Migrations)

## Оглавление

1. [Описание](#описание)
2. [Требования](#требования)
3. [Установка и настройка](#установка-и-настройка)
    - [Быстрый старт](#быстрый-старт)
6. [Эндпоинты API](#эндпоинты-api)
    - [Сохранение записи](#1-сохранение-записи)
    - [Загрузка записи](#2-загрузка-записи)
    - [Получение последней версии](#3-получение-последней-версии)
    - [Получение всех записей](#4-получение-всех-записей)
    - [Обновление записи по ID](#5-обновление-записи-по-id)
    - [Удаление записи по ID](#6-удаление-записи-по-id)
7. [Тестирование API](#тестирование-api)
8. [Полезные команды](#полезные-команды)
9. [Структура проекта](#структура-проекта)

---

## Описание

Это API проект на платформе ASP.NET Core 9 с использованием SQLite для хранения данных. Этот документ описывает, как настроить, запустить и работать с проектом, включая миграции базы данных.
Скорее всего будет работать и на более ранних версиях .NET Core, но это не гарантируется.
---

## Требования

- **.NET SDK 9.0**: [Скачать](https://dotnet.microsoft.com/download)
- SQLite
- Командная строка или терминал
- (Опционально) Visual Studio, Rider или любой другой IDE для работы с проектом

---

## Установка и настройка

### Быстрый старт

1. Склонируйте репозиторий и перейдите в его директорию:

   ```bash
   git clone https://github.com/Igwade/SaveServerAspNet
   cd SaveServerAspNet
   ```

2. Установите зависимости:

   ```bash
   dotnet restore
   ```
3. Опционально: Установка Entity Framework Core:

   ```bash
   dotnet tool install --global dotnet-ef
   ```

4. Создайте и выполните миграцию для инициализации базы данных:

   ```bash
   dotnet ef migrations add InitialCreate
   dotnet ef database update
   ```

5. Запустите проект:

   ```bash
   dotnet run
   ```

   Приложение будет доступно по адресам:
    - `http://localhost:5041`
    - `https://localhost:7159`

---

## Эндпоинты API

### 1. Сохранение записи
- **URL**: `PUT /save`
- **Параметры запроса**:
    - `version` (string, required): Версия записи
    - `content` (string, required): Содержимое записи
- **Описание**: Создает или обновляет запись с указанной версией.

### 2. Загрузка записи
- **URL**: `GET /load`
- **Параметры запроса**:
    - `version` (string, required): Версия записи
- **Описание**: Загружает запись с указанной версией. Если контент JSON-формата, возвращает его как объект.

### 3. Получение последней версии
- **URL**: `GET /latest-version`
- **Описание**: Возвращает последнюю сохраненную версию.

### 4. Получение всех записей
- **URL**: `GET /`
- **Описание**: Возвращает список всех записей с их ID, версией и содержимым.

### 5. Обновление записи по ID
- **URL**: `PUT /{id}`
- **Параметры пути**:
    - `id` (int, required): Идентификатор записи
- **Тело запроса**: Содержит новое содержимое записи.
- **Описание**: Обновляет запись по её ID.

### 6. Удаление записи по ID
- **URL**: `DELETE /{id}`
- **Параметры пути**:
    - `id` (int, required): Идентификатор записи
- **Описание**: Удаляет запись по её ID.

---

## Тестирование API

Вы можете использовать инструменты, такие как [Postman](https://www.postman.com/) или [curl](https://curl.se/), для тестирования API. Например, чтобы выполнить GET-запрос:

```bash
curl -X GET https://localhost:7159/load?version=1
```

---

## Полезные команды

- **Восстановление зависимостей**: `dotnet restore`
- **Сборка проекта**: `dotnet build`
- **Запуск проекта**: `dotnet run`
- **Применение миграций**: `dotnet ef database update`
- **Создание миграции**: `dotnet ef migrations add <НазваниеМиграции>`

---

## Структура проекта

- **Dependencies/**: Папка для управления зависимостями проекта.
- **Properties/**: Содержит файл `launchSettings.json`, который определяет настройки запуска приложения, включая порты и переменные окружения.
- **Controllers/**: Контроллеры API. Например, `RecordsController.cs` управляет эндпоинтами для работы с записями.
- **Data/**: Содержит файл `AppDbContext.cs`, который описывает контекст базы данных и позволяет взаимодействовать с таблицами SQLite через Entity Framework.
- **Models/**: Модели данных. Например, `Record.cs` определяет структуру данных для записи в базе данных.
- **appsettings.json**: Основной файл конфигурации приложения, где указываются строки подключения к базе данных и настройки логирования.
- **appsettings.Development.json**: Локальная конфигурация для разработки, которая переопределяет параметры из `appsettings.json`.
- **Program.cs**: Точка входа в приложение, где настраиваются и запускаются все службы.

---
